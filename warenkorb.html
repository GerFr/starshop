<!doctype html>
<html lang="en">
    <head>
        <title>Warenkorb</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Bootstrap CSS v5.2.1 -->
        <link href="css/bootstrap.min.css" rel="stylesheet" />
        <!-- icons -->
        <link rel="icon" href="assets/icons/cart.png">
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

        <script src="js/handlebars.min-v4.7.8.js"></script>
        <script src="js/vanilla.js"></script>

        <script>
            function init() {
                render({}, '[type="text/x-handlebars-navbar"]')
                render({}, '[type="text/x-handlebars-footer"]')
        
                const cartIDdata = JSON.parse(sessionStorage.getItem("cart"))
                const baseData =JSON.parse(localStorage.getItem("data"))
                const cartData = []

                if ((!(cartIDdata===null)) && (!(baseData===null))){
                    for (var j = 0; j < cartIDdata.length; j++){
	                    for (var i = 0; i < baseData.length; i++){
		                    if (baseData[i].StarID == (Number(cartIDdata[j]))){
			                    cartData.push(baseData[i])
		                    }
                        }
	                }
                }
                var total = 0
                for (let i = 0; i < cartData.length; i++){
                    total += cartData[i]["Price"]
                }
                var colorcount = {bcount:0, 
					              bwcount:0, 
                                  orcount:0, 
                                  ocount:0, 
                                  wcount:0, 
                                  ycount:0, 
                                  ywcount:0}

                if (!(cartData.length==0)){
                    for (let i = 0; i < cartData.length; i++){
                        if (cartData[i]["Color"]=='blueStar'){
                            colorcount.bcount = colorcount.bcount + 1
                        }
                        else if (cartData[i]["Color"]=='blueWhiteStar'){
                            colorcount.bwcount = colorcount.bwcount+ 1
                        }
                        else if (cartData[i]["Color"]=='orangeRedStar'){
                            colorcount.orcount = colorcount.orcount+ 1
                        }
                        else if (cartData[i]["Color"]=='orangeStar'){
                            colorcount.ocount = colorcount.ocount+ 1
                        }
                        else if (cartData[i]["Color"]=='whiteStar'){
                            colorcount.wcount = colorcount.wcount+ 1
                        }
                        else if (cartData[i]["Color"]=='yellowStar'){
                            colorcount.ycount = colorcount.ycount+ 1
                        }
                        else if (cartData[i]["Color"]=='yellowWhiteStar'){
                            colorcount.ywcount = colorcount.ywcount+ 1
                        }
                    }
                    console.log(colorcount)
                    var max = 0
                    for (const [key, value] of Object.entries(colorcount)) {
                        if (value > max){
                            max = [key, value]
                        }
                    }
                    console.log(max)
                    var products = document.getElementById('prod1');
                    products.setAttribute('value', max)

                }

              
                                
                var infos = document.getElementById('total');
                infos.setAttribute('value', 'Total Summary '+  total + " â‚¬")
                render({ "total": total }, '[type="text/x-handlebars-template-2"]')
                console.log(total)
                if (cartData.length>0){
                render(cartData,  '[type="text/x-handlebars-template"]')
                }


            }
        </script>
        <script>
            function deletecart(id){
                cart = JSON.parse(sessionStorage.getItem('cart'))
                for (let i = 0; i<cart.length; i++){
                    if (cart[i]===id){
                        cart.splice(i, 1)
                        sessionStorage.setItem("cart", JSON.stringify(cart))
                        location.reload()
                    }
                }
            }
        </script>
    </head>

    <body onload="init()">
        <script id="template" type="text/x-handlebars-navbar">
        {{> navbar }}
        </script>
        <div></div>

        <main>
            <div class="container-xl">
                <h4
                    class="d-flex justify-content-between align-items-center mb-3">
                    <span class="text-muted">Your cart</span>
                </h4>
                <script id="template" type="text/x-handlebars-template">
                    {{> cartcard }}
                </script>
                <div></div>
                <input id="total" type="text" class="form-control" readonly>
                <hr>
                <a name="checkout" id class="btn btn-primary"
                    href="checkout.html" role="button">Checkout</a>
                <div class="ibox">
                    <div class="ibox-content">
                        <p class="font-bold">
                            Other products you may be interested
                        </p>
                        <hr>
                        <div>
                            <a id='prod1' href="index.html#495-card"
                                class="product-name">
                                Product 1</a>
                            <div class="small m-t-xs">
                                Star "n"
                            </div>
                            <div class="m-t text-righ">
                                <a
                                    class="btn btn-xs btn-outline btn-primary">Info
                                    <i class="fa fa-long-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <script id="template" type="text/x-handlebars-footer">
            {{> footer }}
        </script>
        <div></div>
        <!-- Bootstrap JavaScript Libraries -->
        <script src="js/bootstrap.js"></script>
    </body>

</html>