<!doctype html>
<html lang="en">

<head>
    <title>Confirmation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="icon" href="assets/icons/cart.png">
    <!-- handlebars -->
    <script src="js/handlebars.min-v4.7.8.js"></script>
    <script src="js/vanilla.js"></script>
    <script src="js/checkout.js"></script>

    <script>
        function init() {
            const checkout = JSON.parse(sessionStorage.getItem("checkout"))
            render(checkout, '[type="text/x-handlebars-checkout"]')

            if (!(sessionStorage.getItem('cart') === null)) {
                const cartIDs = JSON.parse(sessionStorage.getItem("cart"))
                const cart = []
                cartIDs.forEach(element => {
                    const data = getElement(element)
                    if (!(data === null)) {
                        cart.push(data)
                    }
                });
                total = 0
                cart.forEach(element => {
                    total += element["Price"]
                });
                render({ "total": total }, '[type="text/x-handlebars-template-2"]')

                if (cart.length > 0) {
                    render(cart, '[type="text/x-handlebars-cart"]')
                }
            toOrders(checkout, cart, total)
            }
            render({}, '[type="text/x-handlebars-navbar"]')
            render({}, '[type="text/x-handlebars-footer"]')
        }

        function toOrders(checkout, data, total) {
            var orders = JSON.parse(localStorage.getItem("orders"))
            if (orders === null) {
                orders = [{"checkout":checkout, "data":data, "total":total}]
            }
            else if (validateOrder(orders, total)){
                orders.push({"checkout":checkout, "data":data, "total":total});
            }
            localStorage.setItem("orders", JSON.stringify(orders))
        }

        function validateOrder(orders, total){
            	orders.forEach(element => {
                if (element.total === total){
                    return false;
                }
                return true;
            });
        }

    </script>
</head>

<body onload="init()">
    <script id="template" type="text/x-handlebars-navbar">
        {{> navbar }}
    </script>
    <div></div>
    <!-- MARK: Support Card
         -->
    <section id="Support Card">
        <div class="container-lg justify-content-center">
            <div class="row align-content-center justify-content-center">
                <div class="col-lg-8">
                    <div class="card bg-dark ">
                        <div class="card-body ">
                            <h4 class="card-title pb-4 text-center">Your order is arriving soon</h4>
                            <script id="template" type="text/x-handlebars-cart">
                                {{#each this}}
                                <li class="list-group-item d-flex justify-content-between lh-condensed">
                                    <div>
                                        <h6 class="my-0 text-start">{{ProperName}}</h6>
                                        <small class="text-muted">
                                            {{#if (lt Price 100000)}}
                                            <strong>Sale</strong>
                                            {{/if}}
                                            Distance: {{Distance}}
                                        </small>
                                      </div>
                                    <span class="text-muted">€{{Price}}</span>
                                </li>
                                {{/each}}
                                </script>

                            <ul class="list-group mb-3">
                            </ul>
                            <script id="template" type="text/x-handlebars-template-2">
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>
                                        Total
                                    </span>
                                    <strong>
                                        €{{total}}
                                    </strong>
                                </li>
                            </script>
                            <ul class="list-group mb-3">
                            </ul>

                            <script id="template" type="text/x-handlebars-checkout">
                                {{#each this}}
                                <li class="list-group-item d-flex justify-content-between lh-condensed">
                                    <div>
                                        <h6 class="my-0 text-start">{{name}}</h6>
                                        
                                      </div>
                                    <span class="text-muted">{{value}}</span>
                                </li>
                                {{/each}}
                            </script>
                            <ul class="list-group mb-3">
                            </ul>
                            <div class="card-footer text-center ">
                                <a href="/index.html" class="btn btn-primary btn-lg">Home</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </section>
    </main>
    <!-- MARK: footer
         -->
    <script id="template" type="text/x-handlebars-footer">
        {{> footer }}
    </script>
    <div></div>

    <!-- Bootstrap JavaScript Libraries -->
    <script src="js/bootstrap.js"></script>
</body>

</html>